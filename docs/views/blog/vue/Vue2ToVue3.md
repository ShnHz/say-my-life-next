---
date: 2020/07/14 10:02:59 
config: {
    top: false,
    dir: false,
    tag: ['vue','js','info'],
    valine: true,
    valineId: /blog/vue/Vue2ToVue3.html
}
title : 阿里妈妈又做了新工具，帮你把 Vue2 代码改成 Vue3 的
---
###### 原文 [掘金](https://juejin.cn/post/6977259197566517284)

<img src="https://cdn.chenyingshuang.cn/blog/Vue2ToVue3/1.jpg" class="lazy article-hero" style="">

<h1 data-v-235a9386="" class="article-title">
            阿里妈妈又做了新工具，帮你把 Vue2 代码改成 Vue3 的
            <!----></h1>
<p>Vue3 已经出来有一段时间了，很多朋友早已熟读了文档，写了好几个 Demo，馋 Composition API 等新特性已久了。无奈，在实际工作中，大部分朋友还是不得不守着成千上万行的 Vue2 老项目过日子，做一次框架升级就像给老房子装修——念头总是充沛，决心总是匮乏。</p>

<p>其实 Vue 团队已经尽可能地减少了破坏性更新，还提供了一份细致的<a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Farray-refs.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/array-refs.html" ref="nofollow noopener noreferrer">迁移指南</a>，条数不少，但定睛一看，大部分都是体力活，有些很简单，比如异步组件要多包上一层：</p>
<p><img src="https://cdn.chenyingshuang.cn/blog/Vue2ToVue3/2.jpg" alt="image.png" loading="lazy" class="medium-zoom-image">还有一些就改起来有点麻烦，比如自定义指令生命周期的更名，和传入参数的一些细微变化：</p>
<p><img src="https://cdn.chenyingshuang.cn/blog/Vue2ToVue3/3.jpg" alt="image.png" loading="lazy" class="medium-zoom-image"></p>
<p>看到这种变化后，作为厌恶重复的程序员，已经开始盘算着能不能写个代码帮我们把这些规则批量给改好了，当然，写转换代码的代码要比写网页难上不少，还好我们之前已经有了一个趁手的工具： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fthx%2Fgogocode" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/thx/gogocode" ref="nofollow noopener noreferrer">GoGoCode</a>。</p>
<p>我们之前的文章<a href="https://juejin.cn/post/6938601548192677918" target="_blank" title="https://juejin.cn/post/6938601548192677918">《阿里妈妈出的新工具，给批量修改项目代码减轻了痛苦》</a>介绍过它，作为一个更简单的 AST处理工具，能大大减轻转换逻辑的书写难度，简直就是为了这事儿量身打造的！</p>
<p>于是我们梳理了<a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Farray-refs.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/array-refs.html" ref="nofollow noopener noreferrer">迁移指南</a>里提到的，附带上 vue-router \ vuex 升级的一些 API 变化，配合 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fthx%2Fgogocode" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/thx/gogocode" ref="nofollow noopener noreferrer">GoGoCode</a> 书写了近 30 条转换逻辑，涵盖了 Vue2 到 Vue3 代码 break change 的大部分场景，这个程序可以帮助你一键把 Vue2 的代码转换成 Vue3 的代码。</p>
<p>上面提到的两条 Vue2 到 Vue3 的差异对比中，右侧 Vue3 的代码就是通过这个工具根据左侧 Vue2 代码原片直出的，效果还不错吧 ^_^，我们来一起试一下！</p>
<h2 data-id="heading-0">尝试一下</h2>
<p>全局安装 gogocode-cli</p>
<pre><code class="hljs language-bash copyable" lang="bash">npm install gogocode-cli -g
<span class="copy-code-btn">复制代码</span></code></pre>
<p>在终端（terminal）中跳转到需要升级的 Vue 项目路径。如果需要升级 src 路径下的 Vue 代码，执行如下命令</p>
<pre><code class="hljs language-bash copyable" lang="bash">gogocode -s ./src -t gogocode-plugin-vue -o ./src-out
<span class="copy-code-btn">复制代码</span></code></pre>
<p>转换操作执行完毕后新的 Vue3 代码会被写入到 src-out 目录中</p>
<p>我们拿 Vue2 的官方示例项目 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fvue-hackernews-2.0" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/vuejs/vue-hackernews-2.0" ref="nofollow noopener noreferrer">vue-hackernews-2.0</a> 试了一下，发现在转换的基础上只要稍作改动再改一下构建流程就能跑起来了，一些转换的 Diff 如下：（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fthx%2Fgogocode%2Fcommit%2F6506a0e693aff1896da6c8863fa7e7c72d89610f%3Fbranch%3D6506a0e693aff1896da6c8863fa7e7c72d89610f%26diff%3Dsplit" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/thx/gogocode/commit/6506a0e693aff1896da6c8863fa7e7c72d89610f?branch=6506a0e693aff1896da6c8863fa7e7c72d89610f&amp;diff=split" ref="nofollow noopener noreferrer">查看完整 Diff</a>）</p>
<p><img src="https://cdn.chenyingshuang.cn/blog/Vue2ToVue3/4.jpg" alt="image.png" loading="lazy" class="medium-zoom-image"></p>
<p><img src="https://cdn.chenyingshuang.cn/blog/Vue2ToVue3/5.jpg" alt="image.png" loading="lazy" class="medium-zoom-image"></p>
<p>这里只是简单地介绍，完整的方案请参考：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgogocode.io%2Fzh%2Fdocs%2Fspecification%2Fvue2-to-vue3" target="_blank" rel="nofollow noopener noreferrer" title="https://gogocode.io/zh/docs/specification/vue2-to-vue3" ref="nofollow noopener noreferrer">文档</a></p>
<h2 data-id="heading-1">实现比预想的要简单很多</h2>
<p>为了达成转换目的，<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fthx%2Fgogocode" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/thx/gogocode" ref="nofollow noopener noreferrer">GoGoCode</a> 新增支持了对 .vue 文件的解析，我们可以轻松地获取到解析好的 template 和 scirpt AST节点，并利用 GoGoCode 方便的 API 进行处理。</p>
<p>一些简单的规则，比如前面介绍的异步组件转换直接进行类似字符串的替换即可，由于是基于 AST 的，所以无需关心代码格式，工作量是很小的：</p>
<pre><code class="hljs language-typescript copyable" lang="typescript">script
  .replace(<span class="hljs-string">'() =&gt; import($_$)'</span>, <span class="hljs-string">'Vue.defineAsyncComponent(() =&gt; import($_$))'</span>)
  .replace(
    <span class="hljs-string">`
      () =&gt; ({
        component: import($_$1),
        $$$
      })`</span>,
    <span class="hljs-string">`
    Vue.defineAsyncComponent({
      loader: () =&gt; import($_$1),
      $$$
    })
      `</span>
  );
<span class="copy-code-btn">复制代码</span></code></pre>
<p>这次项目也检验了 GoGoCode 对复杂情况的处理，就像前面提到的自定义指令生命周期的变化，也很轻松地做到！</p>
<h2 data-id="heading-2">开源了，希望能得到大家的反馈</h2>
<p>吃水不忘挖井人，希望这些工作能为 Vue 开源社区做些贡献，让社区尽快享受到Vue3带来的技术红利，也让Vue团队的成员能够拜托 Vue2 的历史包袱，更加聚焦于Vue3新特性的研发！项目伊始，存在的不足之处希望得到大家的反馈和帮助：</p>
<p>issues: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fthx%2Fgogocode%2Fissues" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/thx/gogocode/issues" ref="nofollow noopener noreferrer">github.com/thx/gogocod…</a></p>
<p>钉钉群：34266233</p>
<p>最后：求 star 支持！</p>
<p>Github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fthx%2Fgogocode" target="_blank" rel="nofollow noopener noreferrer" title="https://github.com/thx/gogocode" ref="nofollow noopener noreferrer">github.com/thx/gogocod…</a>（本项目在 packages/gogocode-plugin-vue/ 目录下）</p>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgogocode.io" target="_blank" rel="nofollow noopener noreferrer" title="https://gogocode.io" ref="nofollow noopener noreferrer">gogocode.io</a></p>
<h2 data-id="heading-3">附录：当前转换规则覆盖</h2>

<table><thead><tr><th>规则</th><th>转换支持</th><th>文档</th></tr></thead><tbody><tr><td>v-for 中的 Ref 数组</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Farray-refs.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/array-refs.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>异步组件</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fasync-components.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/async-components.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>attribute 强制行为</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fattribute-coercion.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/attribute-coercion.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>$attrs包含class&amp;style</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fattrs-includes-class-style.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/attrs-includes-class-style.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>$children</td><td>✖️</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fchildren.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/children.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>自定义指令</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fcustom-directives.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/custom-directives.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>自定义元素交互</td><td>无需转换</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fcustom-elements-interop.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/custom-elements-interop.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>Data 选项</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fdata-option.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/data-option.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>emits选项</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Femits-option.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/emits-option.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>事件 API</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fevents-api.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/events-api.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>过滤器</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Ffilters.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/filters.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>片段</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Ffragments.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/fragments.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>函数式组件</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Ffunctional-components.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/functional-components.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>全局 API</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fglobal-api.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/global-api.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>全局 API Treeshaking</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fglobal-api-treeshaking.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/global-api-treeshaking.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>内联模板 Attribute</td><td>✖️</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Finline-template-attribute.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/inline-template-attribute.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>keyattribute</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fkey-attribute.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/key-attribute.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>按键修饰符</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fkeycode-modifiers.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/keycode-modifiers.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>移除$listeners</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Flisteners-removed.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/listeners-removed.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>挂载API变化</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fmount-changes.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/mount-changes.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>propsData</td><td>开发中</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fprops-data.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/props-data.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>在 prop 的默认函数中访问this</td><td>无需转换</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fprops-default-this.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/props-default-this.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>渲染函数 API</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Frender-function-api.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/render-function-api.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>插槽统一</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fslots-unification.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/slots-unification.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>Suspense</td><td>无需转换</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fsuspense.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/suspense.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>过渡的 class 名更改</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Ftransition.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/transition.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>Transition 作为 Root</td><td>开发中</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Ftransition-as-root.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/transition-as-root.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>Transition Group 根元素</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Ftransition-group.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/transition-group.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>移除v-on.native修饰符</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fv-on-native-modifier-removed.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/v-on-native-modifier-removed.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>v-model</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fv-model.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/v-model.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>v-if 与 v-for 的优先级对比</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fv-if-v-for.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/v-if-v-for.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>v-bind 合并行为</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fv-bind.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/v-bind.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>VNode 生命周期事件</td><td>开发中</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fvnode-lifecycle-events.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/vnode-lifecycle-events.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>Watch on Arrays</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Fmigration%2Fwatch.html" target="_blank" rel="nofollow noopener noreferrer" title="https://v3.cn.vuejs.org/guide/migration/watch.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>vuex</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fnext.vuex.vuejs.org%2Fzh%2Fguide%2Fmigrating-to-4-0-from-3-x.html" target="_blank" rel="nofollow noopener noreferrer" title="https://next.vuex.vuejs.org/zh/guide/migrating-to-4-0-from-3-x.html" ref="nofollow noopener noreferrer">链接</a></td></tr><tr><td>vue-router</td><td>✔</td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fnext.router.vuejs.org%2Fzh%2Fguide%2Fmigration%2Findex.html" target="_blank" rel="nofollow noopener noreferrer" title="https://next.router.vuejs.org/zh/guide/migration/index.html" ref="nofollow noopener noreferrer">链接</a></td></tr></tbody></table></div></div>
