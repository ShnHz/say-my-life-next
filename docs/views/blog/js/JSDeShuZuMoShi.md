---
title: JS的数组模式
date: 2022/12/20 12:05:29
summary: 
config: {
    show: false,
    top: false,
    dir: true,
    dirTag: ["h3","h4","h5"],
    tag: ["js"],
    valine: true,
    valineId: 
}
password: false
outline: [3, 5]
---

首先我们来看看这两段代码

```js
console.time()
const arr1 = []
for (let i = 0; i < 100000000; i++) {
    arr1[i] = 1
}
console.timeEnd()
```

这段代码的执行耗时是 ->958.705322265625 ms<-

```js
console.time()
const arr2 = []
arr2[100000000 - 1] = 1
for (let i = 0; i < 100000000; i++) {
    arr2[i] = 1
}
console.timeEnd()
```

这段代码的执行耗时是 ->6455.6630859375 ms<-

这两段代码的区别仅仅是->arr2<-提前给数组的最后一项赋值，那为什么会有这么大的执行时间差距呢

:::tip 为什么？
归根结底，是因为V8会以不同的形式去存储JS数组

模式一：**快速模式**

模式二：**字典模式**
:::

#### 快速模式

对应C语言中的数组，速度快，紧凑

触发机制：

+ 索引从->0<-至->length-1<-且无空洞
+ 或 预分配数组小于->100000<-，无论有空洞

#### 字典模式

对应C语言中的哈希表，速度慢，松散

触发机制：

+ 预分配数组大于等于->100000<-，且数组有空洞


#### V8数组模式 - 优化策略

+ 从0开始连续的初始化数组，以避免数组进入字典模式
+ 不要预分配一个超大数组
+ 删除数组元素时让数组保持紧凑，尽可能的避免使用delete
+ 不要访问未初始化或已删除的数组元素