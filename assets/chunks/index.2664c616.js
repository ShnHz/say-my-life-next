var y=globalThis&&globalThis.__awaiter||function(t,s,e,i){function n(h){return h instanceof e?h:new e(function(c){c(h)})}return new(e||(e=Promise))(function(h,c){function a(r){try{u(i.next(r))}catch(l){c(l)}}function f(r){try{u(i.throw(r))}catch(l){c(l)}}function u(r){r.done?h(r.value):n(r.value).then(a,f)}u((i=i.apply(t,s||[])).next())})};class g{constructor(s,e,i,n){d(s),b(s),this.obj=s,this.input=typeof e=="string"?[e]:e,this.fn=typeof i=="function"?i:function(){},this.hooks=typeof n=="function"?n:function(){},this.timer=0,this.typeAction={rollback:this.typedBack.bind(this),normal:this.play.bind(this),custom:this.fn},this.init()}init(){this.play()}play(){if(!this.input.length)return this.fn(this);let s=0,e=!1,i=this.input.shift()||"";this.timer=setInterval(()=>{if(s===i.length&&(s=0,e=!0,this.closeTimer()),this.obj.isEnd)return this.closeTimer();if(e)return this.nextTick();this.obj.output=i.slice(0,s+1),this.hooks(i.slice(0,s+1),this),s++},this.obj.speed)}typedBack(){if(!this.input.length&&this.obj.sentencePause)return this.fn(this);let s=this.obj.output,e=s.length,i=!1;this.timer=setInterval(()=>{if(e===-1&&(this.obj.output="",this.hooks("",this),e=0,i=!0,this.closeTimer()),this.obj.isEnd)return this.closeTimer(),this.obj.singleBack=!1;if(i)return this.obj.singleBack=!1,(()=>{const{length:n}=this.input;return n?this.play():this.fn(this)})();this.obj.output=s.slice(0,e+1),this.hooks(s.slice(0,e+1),this),e--},this.obj.backSpeed)}nextTick(){return y(this,void 0,void 0,function*(){return yield this.sleep(this.obj.sleep),this.obj.singleBack?this.typedBack():this.getOutputType()})}getOutputType(){return this.typeAction[this.obj.type](this)}closeTimer(){clearInterval(this.timer)}sleep(s){return new Promise(e=>setTimeout(e,s))}close(){return this.obj.isEnd=!0}}const p=t=>{throw new Error(t)},d=t=>{const e=Object.keys({output:"",type:"",isEnd:!1,speed:80,backSpeed:40,sleep:3e3,singleBack:!1,sentencePause:!1}),i=Object.keys(t);e.length!==i.length&&p("配置对象错误: 字段数量不正确！"),e.forEach(n=>{(t[n]===void 0||t[n]===null)&&p("配置对象错误：字段值为null或undefined！")})},b=t=>{Object.keys(t).forEach(s=>{const e=k[s](t);e.check()&&e.showTip(s)})},k=(()=>({output:t=>new o("string",t.output),type:t=>new o("string",t.type),isEnd:t=>new o("boolean",t.isEnd),speed:t=>new o("number",t.speed),backSpeed:t=>new o("number",t.backSpeed),sleep:t=>new o("number",t.sleep),singleBack:t=>new o("boolean",t.singleBack),sentencePause:t=>new o("boolean",t.sentencePause)}))();class o{constructor(s,e){this.type=s,this.field=e}check(){return typeof this.field!=`${this.type}`}showTip(s){p(`配置对象错误：属性 ${s} 必须为 ${this.type} 类型！`)}}export{g as default};
