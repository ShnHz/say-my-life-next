import{_ as o,o as p,c as e,S as n,C as a,a as l}from"./chunks/framework.7114eebe.js";const E=JSON.parse('{"title":"不要再滥用可选链运算符(?.)啦！","description":"","frontmatter":{"title":"不要再滥用可选链运算符(?.)啦！","date":"2024/02/23 16:37:06","summary":null,"config":{"show":true,"top":false,"dir":true,"dirTag":["h3","h4","h5"],"tag":["info","js"],"valine":true,"valineId":null},"password":false,"outline":[3,5]},"headers":[],"relativePath":"views/blog/js/BuYaoZaiLanYongKeXuanLianYunSuanFuLa.md","filePath":"views/blog/js/BuYaoZaiLanYongKeXuanLianYunSuanFuLa.md"}'),t={name:"views/blog/js/BuYaoZaiLanYongKeXuanLianYunSuanFuLa.md"},c={href:"https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2FOptional_chaining",target:"_blank",title:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Optional_chaining",ref:"nofollow noopener noreferrer"},r={href:"https://link.juejin.cn?target=https%3A%2F%2Fwww.typescriptlang.org%2Fplay",target:"_blank",title:"https://www.typescriptlang.org/play",ref:"nofollow noopener noreferrer"};function y(i,s,D,F,B,d){return p(),e("div",null,[s[3]||(s[3]=n('<h6 id="原文-掘金" tabindex="-1">原文 <a href="https://juejin.cn/post/7280747572707999799" target="_blank" rel="noreferrer">掘金</a> <a class="header-anchor" href="#原文-掘金" aria-label="Permalink to &quot;原文 [掘金](https://juejin.cn/post/7280747572707999799)&quot;">​</a></h6><h2 id="前言" tabindex="-1">前言 <a class="header-anchor" href="#前言" aria-label="Permalink to &quot;前言&quot;">​</a></h2><p>之前整理过 <a href="https://juejin.cn/post/7235109911780311101" target="_blank" title="https://juejin.cn/post/7235109911780311101">整理下最近做的产品里 比较典型的代码规范问题</a>，里面有一个关于<code>可选链运算符(?.)</code>的规范，当时只是提了一下，今天详细说下想法，欢迎大佬参与讨论。</p>',3)),a("p",null,[a("a",c,"可选链运算符(?.)",512),s[0]||(s[0]=l("，大家都很熟悉了，直接看个例子："))]),s[4]||(s[4]=n(`<div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> obj</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">a</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">b</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">c</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">d</span></span></code></pre></div><p>很简单例子，上面代码?前面的属性如果是空值（null或undefined），则result值是undefined，反之如果都不是空值，则会返回最后一个d属性值。</p><p>本文不是讲解这种语法的用法，主要是想分析下日常开发中，这种语法 <strong>滥用、乱用</strong> 的问题。</p><h2 id="滥用、乱用" tabindex="-1">滥用、乱用 <a class="header-anchor" href="#滥用、乱用" aria-label="Permalink to &quot;滥用、乱用&quot;">​</a></h2><p>最近在code review一个公司项目代码，发现代码里用到的<code>可选链运算符</code>，很多滥用，用的很无脑，经常遇到这种代码：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> userName </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">items</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">[</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">]</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">name</span></span></code></pre></div><p>↑ 不管对象以及属性有没有可能是空值，无脑加上<code>?.</code>就完了。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// react class component</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> name </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">state</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// react hooks</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">items</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> setItems</span><span style="color:#89DDFF;">]</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useState</span><span style="color:#BABED8;">([])</span></span>
<span class="line"><span style="color:#BABED8;">items</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">map</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#82AAFF;">setItems</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">([]) </span><span style="color:#676E95;font-style:italic;">// 真有这么写的</span></span></code></pre></div><p>↑ React框架下，this.state 值不可能是空值，初始化以及set的值都是数组，都无脑加上<code>?.</code></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> item1 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> obj</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item1</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(item1</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name)</span></span></code></pre></div><p>↑ 第一行代码说明obj或item1可能是空值，但第二行也明显说明不可能是空值，否则依然会抛错，第一行的<code>?.</code>也就没意义了。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> (obj</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item1</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item2) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">item2</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">obj</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item1</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item2</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">obj</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item1</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item2</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">name</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>↑ if 里已经判断了非空了，内部就没必要判断非空了。</p><h2 id="问题、缺点" tabindex="-1">问题、缺点 <a class="header-anchor" href="#问题、缺点" aria-label="Permalink to &quot;问题、缺点&quot;">​</a></h2><p>如果不考虑 <code>?.</code> 使用的<code>必要性</code>，无脑滥用其实也没问题，不会影响功能，优点也很多：</p><ol><li>不用考虑是不是非空，每个变量或属性后面加 <code>?.</code> 就完了。</li><li>由于不用思考，开发效率高。</li><li>不会有空引用错误，不会有页面点点就没反应或弹错问题。</li></ol><p>但是问题和缺点也很明显，而且也会很严重。分两点分析下：</p><ol><li><strong>可读性、维护性：给代码维护人员带来了很多分析代码的干扰，代码可读性和维护性都很差。</strong></li><li><strong>隐式过滤了异常：把异常给隐式过滤掉了，导致不能快速定位问题。</strong></li><li><strong>编译后代码冗余。</strong></li><li><strong>护眼：一串?.看着难受，特别是以一个code reviewer 角度看。</strong></li></ol><h3 id="_1-可读性、维护性" tabindex="-1">1. 可读性、维护性 <a class="header-anchor" href="#_1-可读性、维护性" aria-label="Permalink to &quot;1. 可读性、维护性&quot;">​</a></h3><p>可读性和维护性其实是一回事，都是指不是源代码作者的开发维护人员，在捋这块代码逻辑、修改bug等情况时，处理问题的效率，代码写的好处理就快，写的烂就处理慢，很简单道理。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> onClick </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> () </span><span style="color:#89DDFF;">=&amp;</span><span style="color:#BABED8;">gt</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">user</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">props</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">items</span><span style="color:#89DDFF;">?.</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">user</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">user</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// use user to do something</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>已这行代码为例，有个bug现象是点击按钮没反应，维护开发看到这块代码，就会想这一串链式属性里，是不是有可能有空值，所以导致了user是空值，没走进if里导致没反应。然后就继续分析上层组件props传输代码，看data值从哪儿传来的，看是不是哪块代码导致data或items空值了。。。</p><p>其实呢？从外部传过来的这一串属性里不会有空值的情况，导致bug问题根本不在这儿。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> user </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> props</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">data</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">items[</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">]</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">user</span></span></code></pre></div><p>那把<code>?.</code>都去掉呢？维护开发追踪问题看到这行代码，data items 这些属性肯定不能是空值，不然console就抛错了，但是bug现象里并没有抛错，所以只需要检查user能不能是空值就行了，很容易就排除了很多情况。</p><p>总结就是：<strong>给代码维护人员带来了很多分析代码的干扰，代码可读性和维护性都很差。</strong></p><h3 id="_2-隐式过滤了异常" tabindex="-1">2. 隐式过滤了异常 <a class="header-anchor" href="#_2-隐式过滤了异常" aria-label="Permalink to &quot;2. 隐式过滤了异常&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">api</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#BABED8;">(result </span><span style="color:#89DDFF;">=&amp;</span><span style="color:#BABED8;">gt; </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    const id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> result</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">id</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// use id to do something</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span></code></pre></div><p>比如有个需求，从后台api获取数据时，需要把结果里id属性获取到，然后进行数据处理，从业务流程上看，这个api返回的result以及id必须有值，如果没值的话后续的流程就会走不通。</p><p>然后后台逻辑由于写的有问题，导致个别情况返回的 result=null，但是由于前端这里加了<code>?.</code>，导致页面没有任何反应，js不抛错，console也没有log，后续流程出错了，这时候如果想找原因就会很困难，对代码熟悉还行，如果不是自己写的就只能看代码捋逻辑，如果是生产环境压缩混淆了就更难排查了。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#BABED8;">api</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#BABED8;">(result </span><span style="color:#89DDFF;">=&amp;</span><span style="color:#BABED8;">gt; </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    const id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> result</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">id</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// use id to do something</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span></code></pre></div><p>把<code>?.</code>去掉呢？如果api返回值有问题，这里会立即抛错，后面的流程也就不能进行下去了，无论开发还是生产环境都能在console里快速定位问题，即使是压缩混淆的也能从error看出一二，或者在一些前端监控程序里也能监听到。</p><p>其实这种现象跟 try catch 里不加 throw 类似，把隐式异常错误完全给过滤掉了，比如下面例子：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 这个try本意是处理api请求异常</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">data</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getSaveData</span><span style="color:#F07178;">() </span><span style="color:#676E95;font-style:italic;">// 这段js逻辑也在try里，所以如果这个方法内部抛错了，页面上就没任何反应，很难追踪问题</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">result</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">api</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">url</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">data</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// result 逻辑处理</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#BABED8;"> (e) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 好点的给弹个框，打个log，甚至有的啥都不处理</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>总结就是：<strong>把异常给隐式过滤掉了，导致不能快速定位问题。</strong></p><h3 id="_3-编译后代码冗余" tabindex="-1">3. 编译后代码冗余 <a class="header-anchor" href="#_3-编译后代码冗余" aria-label="Permalink to &quot;3. 编译后代码冗余&quot;">​</a></h3>`,36)),a("p",null,[s[1]||(s[1]=l("如果代码是ts，并且编译目标是ES2016，编译后代码会很长。可以看下 ")),a("a",r,"www.typescriptlang.org/play",512),s[2]||(s[2]=l(" 效果。"))]),s[5]||(s[5]=n(`<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0b8663b437094022b0c075768131727b~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1878&amp;h=257&amp;s=39964&amp;e=png&amp;b=fefdfd" alt="image.png" loading="lazy"></p><p>Babel在个别stage下，编译效果一样。</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/38fc44fcb9af4c328242f49d557041a9~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1906&amp;h=630&amp;s=88477&amp;e=png&amp;b=fefefe" alt="image.png" loading="lazy"></p><p>但并不是说一点都不用，意思是尽量减少滥用，这样使用的频率会少很多，这种编译代码沉余也会少不少。</p><h2 id="应该怎么用" tabindex="-1">应该怎么用？ <a class="header-anchor" href="#应该怎么用" aria-label="Permalink to &quot;应该怎么用？&quot;">​</a></h2><p>说了这么多，<code>.?</code> 应该怎么用呢？意思是不用吗？当然不是不能用，这个特性对于开发肯定好处很多的，但是得合理用，不能滥用。</p><ol><li><strong>避免盲目用，滥用，有个点儿就加问号，特别是在一个比较长的链式代码里每个属性后面都加。</strong></li><li><strong>只有可能是空值，而且业务逻辑中有空值的情况，就用；其它情况尽量不要用。</strong></li></ol><p>其实说白了就是：什么时候需要判断一个变量或属性非空，什么时候不需要。首先在使用的时候得想下，问号前面的变量或属性值，有没有可能是空值：</p><ol><li>很明显不可能是空值，比如 React类组件里的 <code>this.state</code> <code>this.props</code>，不要用；</li><li>自己定义的变量或属性，而且没有赋值为空值情况，不要用；</li><li>某些方法或者组件里，参数和属性不允许是空值，那方法和组件里就不需要判断非空。（对于比较common的，推荐写断言，或者判断空值情况throw error）</li><li>后台api请求结果里，要求result或其内部属性必须有值，那这些值就不需要判断非空。</li><li>按正常流程走，某个数据不会有空值情况，如果是空值说明前面的流程出问题了，这种情况就不需要在逻辑里判断非空。</li></ol><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> userName </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">items</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">[</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">]</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">name </span><span style="color:#676E95;font-style:italic;">// 不要滥用，如果某个属性有可能是空值，则需要?.</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> userName </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">items[</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;">]</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">name </span><span style="color:#676E95;font-style:italic;">// 比如data.items数组肯定不是空数组</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> items2 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> items1</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#BABED8;">(item </span><span style="color:#89DDFF;">=&amp;</span><span style="color:#BABED8;">gt; item</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">checked)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> (items2</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">length) </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 不需要?.</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// react class component</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> name </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">state</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">name </span><span style="color:#676E95;font-style:italic;">// 不需要?.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// react hooks</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">items</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> setItems</span><span style="color:#89DDFF;">]</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">useState</span><span style="color:#BABED8;">([])</span></span>
<span class="line"><span style="color:#BABED8;">items</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">map</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">) </span><span style="color:#676E95;font-style:italic;">// 如果setItems没有赋值空值情况，则不需要?.</span></span>
<span class="line"><span style="color:#82AAFF;">setItems</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">([]) </span><span style="color:#676E95;font-style:italic;">// 不需要?.</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> item1 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> obj</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item1 </span><span style="color:#676E95;font-style:italic;">// 不需要?.</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(item1</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name)</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> obj</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">id </span><span style="color:#676E95;font-style:italic;">// 下面代码已经说明不能是空值了，不需要?.</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> name </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> obj</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> (obj</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item1</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item2) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">item2</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">obj</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item1</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item2</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 不需要?.</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">obj</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item1</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item2</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">name</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 不需要?.</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> id </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> obj</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">item</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">id </span><span style="color:#676E95;font-style:italic;">// 不需要?.</span></span>
<span class="line"><span style="color:#BABED8;">api</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#BABED8;">(id)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">...</span><span style="color:#BABED8;">) </span><span style="color:#676E95;font-style:italic;">// 这个api如果id是空值，则api会抛错</span></span></code></pre></div><p>当然，写代码时还得多想一下属性是否可能是空值，<strong>会一定程度的影响开发效率，也一定有开发会觉得很烦，不理解，无脑写<code>?.</code>多容易啊</strong>，但是我从另外两个角度分析下：</p><ol><li>我觉得一个合格的开发应该对自己的代码逻辑很熟悉，应该有责任知道哪些值可能是空值，哪些不可能是空值（并不是说所有，也有大部分了），否则就是对自己的代码了解很少，觉得代码能跑就行，代码质量自然就低。</li><li>想想在这个新特性出来之前大家是怎么写的，会对每个变量和属性都加<code>if非空判断</code>或者用<code>逻辑与(&amp;&amp;)</code>吗？不会吧。</li></ol><h2 id="总结" tabindex="-1">总结 <a class="header-anchor" href="#总结" aria-label="Permalink to &quot;总结&quot;">​</a></h2><p>本文以一个 code reviewer 角度，分析了 <code>可选链运算符(?.)</code> 特性的滥用情况，以及“正确使用方式”，只是代表我本人的看法，欢迎大佬参与讨论，无条件接受任何反驳。</p><p>滥用的缺点：</p><ol><li><strong>可读性、维护性：给代码维护人员带来了很多分析代码的干扰，代码可读性和维护性都很差。</strong></li><li><strong>隐式过滤了异常：把异常给隐式过滤掉了，导致不能快速定位问题。</strong></li><li><strong>编译后代码冗余。</strong></li><li><strong>护眼：一串?.看着难受，特别是以一个code reviewer 角度看。</strong></li></ol><p>“正确用法”：</p><ol><li><strong>避免盲目用，滥用，有个点儿就加问号，特别是在一个比较长的链式代码里每个属性后面都加。</strong></li><li><strong>只有可能是空值，而且业务逻辑中有空值的情况，就用；其它情况尽量不要用。</strong></li></ol><hr>`,25))])}const g=o(t,[["render",y]]);export{E as __pageData,g as default};
